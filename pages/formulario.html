<!DOCTYPE html>
<html>
	<head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Felicidade no Trabalho</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    </head>
    <style>
        body{
            text-align: center;
	        background-color: lightblue;
	        margin: 5vh 0vw 0vh 0vw;
        }
        .login,#regist_form {

            position:relative;
            top: 40%;
            text-align: center;
            margin-top: 2vh;
            width: 99%;
            height: 10%;
            color: rgb(50,50,50);
            background-color: white;
            border: 5px solid lightslategray;
            border-radius: 5px;
            font-size: 40px;
            font-weight: bolder;
        }
        #regist_form {
            width: 40%;
        }
        #initiate {
            width: 40vw;
        }
        #guest {
            width: 21vw;
            height: 10vh;
        }
#title {
font-size: 25px;
color: darkslategray;
font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
}
.questions{
border: 3px solid lightslategray;
width: 70%;
height: 10%;
color: darkslategray;
font-size: 18px;
font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
}
#info_box {
    position: absolute;
    background-color: white;
    color: black;
    text-align: center;
    font-size: 5vw;
    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    width: 100%;
    min-height: 10%;
    z-index: 2;
    border-bottom: 5px solid darkslategray;
    border-radius: 2px;
}
#dark {
	display: none;
	position: absolute;
	top:0%;
	left:0%;
	width: 100%;
	height: 120%;
	background-color: rgba(0,0,0,0.50);
    z-index: 1;
}
.dot {
    height: 8px;
  width: 8px;
  background-color: darkslategray;
  border-radius: 50%;
  display: inline-block;
}
    </style>
    <body>
        <!--<div class="info_box" style="display:none">
            <i class="glyphicon glyphicon-remove"></i>
        </div>-->
        
        
        <div id="dark"></div>
        <div class="login_div">
                <br><br>
            <span class="login" id="title" style="border:none;background-color:lightblue;text-align:center;color:lightslategray;-webkit-text-stroke: 0.5px rgb(50,50,50);font-family: arial">Inicio de Sessão</span><br>
            <!--<input class="login" id="nick" placeholder="nickname" type="password"><br>
            <input class="login" id="password"placeholder="palavra-passe" type="password"><br>-->
            <button class="login" id="initiate">Participar</button><br>
        </div>
        <div class="formulario" style="display:none;">

        </div>
        <script>
            var table2 = []
            var maxq = 0
            table2 = {
                [0] : {
                    title:"<b>A que estabelecimento pertence?",
                    options:[
                        {label:"Colegio Bartolomeu Dias",points:0},
                        {label:"a",points:0},
                        {label:"outro",points:0}
                    ]
                },
                [1] : {
                    title:"<b>Como classificas a tua felicidade enquanto ao:</b> <br>&#9634; Estabelecimento",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [2] : {
                    title:"&#9634; Salário",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [3] : {
                    title:"&#9634; Horário",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [4] : {
                    title:"<b>Relações de trabalho:</b><br>&#9634; Entre Colegas",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [5] : {
                    title:"&#9634; Superior-Trabalhador",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [6] : {
                    title:"<b>Classifica as motivações de trabalho.",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [7] : {
                    title:"<b>Quão eficazes são as estratégias de motivação?",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [8] : {
                    title:"<b>Quando acordas sentes-te motivado para ir trabalhar?",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [9] : {
                    title:"<b>Gostas do que estás a fazer/do que fazes?",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                },
                [10] : {
                    title:"<b>Sentes que as tuas opiniões são ouvidas?",
                    options:[
                        {label:"5",points:0},
                        {label:"4",points:0},
                        {label:"3",points:0},
                        {label:"2",points:0},
                        {label:"1",points:0},
                        {label:"0",points:0}
                    ]
                }
            }
            function initM (newm,initm) {
                if (newm == null) {newm="Inicio de Sessão"};
                $("#title").html(newm);
                    setTimeout(function(){
                        $("#title").html(initm)
                    },3000);
            }
            function enter() {
                $('.login_div').hide();
                    
                    var count = 0
                    for (var o = 0; o < 100; o++) {
                        if (table2[o] != null){
                            count ++;
                        }
                    }
                    //console.log(count)
                for (var i = 0; i < count; i++) {
                    var options = ""
                    
                    var count2 = 0
                    //console.log(table2[i].length)
                    for (var o = 0; o < 6; o++) {
                        if (table2[i].options[o]){
                            count2 ++;
                            
                        }
                    }
                    
                    maxq = count;
                    for (var k = 0; k < count2; k++){
                        if (k == 0) {
                            options = options + "<option value=\"null\"></option>"
                            options = options + "<option value="+k+"_"+table2[i].options[k].points+">"+table2[i].options[k].label+"</option>"
                        }else{
                            options = options + "<option value="+k+"_"+table2[i].options[k].points+">"+table2[i].options[k].label+"</option>"
                        }
                        
                    }
                   
                    var txt = "<p id=\"title\" >"+table2[i].title+"</p><select class=\"questions\" id=\"question_"+i+"\">"+options+"</select><br><br>"
                    
                    //console.log(txt);
                    $(".formulario").append(txt);
            
                        $("#question_"+i).change(function(){
                            $(this).css("border-color","lightslategray");
                        })
            
                }
                $(".formulario").append("<button id=\"regist_form\" onclick=\"getAnswers()\">Submeter</button>");
                $(".formulario").show();
            }
            var infoBoxOpenned = false
            function openBox(text,side) {
                if (side == null) {side="bottom"}
                if (!infoBoxOpenned) {
                    var errormessg = "<div id=\"info_box\"></div>";
                    infoBoxOpenned = true;
                $("#dark").show();
                window.scrollTo(0,0);
                $("body").css("overflow-y","hidden");
                                if(document.getElementById("info_box") == null){
                                    $("body").append(errormessg);
                                    $("#info_box").html(text);
                                    $("#info_box").css(side,"0px");
                                    $("#info_box").delay(3000).fadeOut(500);
                                    setTimeout(function(){
                                    $("#dark").hide();
                                    infoBoxOpenned = false;
                                    $("body").css("overflow-y","auto");
                                    },3500);
                                }else{
                                    $("#info_box").css(side,"0px");
                                    $("#info_box").html(text);
                                    $("#info_box").fadeIn(500).delay(3000).fadeOut(500);
                                    setTimeout(function(){
                                    $("#dark").hide();
                                    infoBoxOpenned = false;
                                    $("body").css("overflow-y","auto");
                                    },4000);
                                }
                                
                }
                
            }
            var submit_error = false;
            function getAnswers() {
                        var submitdata = [];
                        var submit_error = false;
                        
                    for(i=0; i < maxq; i++){
                        var index = $("#question_"+i).val();
                        var label = $("#question_"+i+" > option[value='"+index+"']").html();
                        console.log("#question_"+i,index);
                        if(index =="null"){
                            submit_error = true;
                            submitdata = [];
                            for(k=0; k < maxq; k++){
                                if($("#question_"+k).val() =="null"){
                                $("#question_"+k).css("border-color","rgba(225,0,0,0.5)");
                                }
                            }
                            break;
                        }
                        
                        submitdata[i] = {index:label,points:index.split("_")[1]}
                        
                    }
                    var count = 0
                    $.getJSON('https://ipapi.co/json/', function(data) {
                    
                        if (data.ip == null){data.ip = "0.0.0.0"};
                        if(!submit_error){
                            socket.emit("submit",{data:submitdata,ip:data.ip})
                            
                                openBox("Obrigado por participares","top")
                                setTimeout(function(){
                                    location.reload();
                                },4010);
                                    
                            
                        }else{
                           openBox("Preenche todos os campos, por favor.","top")
                            
                            /*var errormessg = "<div id=\"errormessg\"style=\"text-align: center; margin-top: 10px; width: 100%\">Preenche todos os campos, por favor</div>";

                                if(document.getElementById("errormessg") == null){
                                    $("body").append(errormessg);
                                    $("#errormessg").delay(5000).fadeOut(1000);
                                }else{
                                    $("#errormessg").fadeIn(100).delay(5000).fadeOut(1000);
                                }*/
                        }
                    });
            }
            const socket = io();
            $("#initiate").click(function(){
                enter();
            })
            
            socket.on('checkedI',function(data){
                if (data.bool == true) {
                    enter();
                }else{
                    openBox("Credenciais Incorretas, tente novamente.")
                }
                
            })
            window.onload = function(){
                $.getJSON('https://ipapi.co/json/', function(data) {
                    socket.emit("newCInfo",{data:data});
                });
                
            };
        </script>
    </body>
